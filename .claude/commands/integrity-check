#!/usr/bin/env python3

"""
ChittyOS-Data â†” ChittyLedger Integrity Check
Usage: /integrity-check [case_id]
"""

import sys
import os
import asyncio
from pathlib import Path

# Add current directory to path
sys.path.append(str(Path(__file__).parent.parent.parent))

from chain_status_workflow import EvidenceChainWorkflow

async def main():
    case_id = sys.argv[1] if len(sys.argv) > 1 else "2024D007847"

    print(f"ðŸ” Integrity Check for case {case_id}")
    print("=" * 45)

    workflow = EvidenceChainWorkflow(case_id)

    try:
        # Generate integrity report
        integrity = await workflow.generate_integrity_report()

        status_icon = "âœ…" if integrity['integrity_status'] == "SYNCHRONIZED" else "âš ï¸"
        print(f"{status_icon} Status: {integrity['integrity_status']}")

        print(f"\nðŸ“Š Inventory Comparison:")
        print(f"   ChittyOS-Data files: {integrity['chittyos_file_count']}")
        print(f"   ChittyLedger entries: {integrity['chittyledger_evidence_count']}")
        print(f"   Synchronized: {integrity['synchronized_count']}")

        if integrity['chittyos_only']:
            print(f"\nðŸ“ Files in ChittyOS-Data only ({len(integrity['chittyos_only'])}):")
            for file_hash in integrity['chittyos_only'][:5]:  # Show first 5
                print(f"     â€¢ {file_hash}")
            if len(integrity['chittyos_only']) > 5:
                print(f"     ... and {len(integrity['chittyos_only']) - 5} more")

        if integrity['chittyledger_only']:
            print(f"\nðŸ—ƒï¸ Evidence in ChittyLedger only ({len(integrity['chittyledger_only'])}):")
            for file_hash in integrity['chittyledger_only'][:5]:  # Show first 5
                print(f"     â€¢ {file_hash}")
            if len(integrity['chittyledger_only']) > 5:
                print(f"     ... and {len(integrity['chittyledger_only']) - 5} more")

        print(f"\nðŸ“„ Full report saved to: integrity_report.json")

    except Exception as e:
        print(f"ðŸ’¥ Integrity check error: {e}")
        return 1

    return 0

if __name__ == "__main__":
    sys.exit(asyncio.run(main()))