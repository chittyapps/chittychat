# ChittyOS Platform API Documentation

**Version**: 2.0.0
**Base URL**: `https://{service}.chitty.cc`
**Account**: ChittyCorp CI/CD (0bc21e3a5a9de1a4cc843be9c3e98121)
**Worker**: chittyos-platform-production

---

## Table of Contents

1. [ChittyID Service](#chittyid-service) - `id.chitty.cc`
2. [Authentication Service](#authentication-service) - `auth.chitty.cc`
3. [Sync Service](#sync-service) - `sync.chitty.cc` / `api.chitty.cc`
4. [AI Gateway](#ai-gateway) - `ai.chitty.cc`
5. [MCP Portal](#mcp-portal) - `mcp.chitty.cc` / `portal.chitty.cc`
6. [Error Codes](#error-codes)
7. [Rate Limits](#rate-limits)
8. [Examples](#examples)

---

## ChittyID Service

**Base URL**: `https://id.chitty.cc`

The ChittyID service is a **pipeline-only** architecture that proxies all ID generation requests to the central ChittyID authority. Local generation is strictly prohibited.

### Endpoints

#### Health Check
```http
GET /health
```

**Response**:
```json
{
  "service": "chitty-id",
  "status": "healthy",
  "mode": "pipeline-only",
  "version": "2.1.0"
}
```

#### Generate ChittyID
```http
POST /generate
Authorization: Bearer <api-key>
Content-Type: application/json
```

**Request Body**:
```json
{
  "metadata": {
    "entityType": "INFO",
    "description": "User data record"
  },
  "sessionContext": {
    "sessionId": "session-123",
    "project": "my-project"
  }
}
```

**Response** (200 OK):
```json
{
  "chittyId": "01-I-NFO-0001-T-25-C-X",
  "source": "id.chitty.cc",
  "pipeline": "chittychat-proxy",
  "note": "Generated by central ChittyID authority",
  "metadata": {
    "entityType": "INFO",
    "description": "User data record"
  },
  "created": "2025-10-04T06:00:00.000Z"
}
```

**Error** (401 Unauthorized):
```json
{
  "error": "API key required",
  "message": "Include Authorization: Bearer <api-key> header"
}
```

**Error** (502 Bad Gateway):
```json
{
  "error": "ChittyID service unavailable",
  "message": "Central service returned 503",
  "service": "id.chitty.cc",
  "note": "ChittyIDs can ONLY be generated by the central service"
}
```

#### Validate ChittyID
```http
GET /validate/{chittyId}
```

**Response** (200 OK):
```json
{
  "valid": true,
  "chittyId": "01-I-NFO-0001-T-25-C-X",
  "hasMetadata": true,
  "format": "VV-G-LLL-SSSS-T-YM-C-X"
}
```

**Response** (Invalid Format):
```json
{
  "valid": false,
  "error": "Invalid ChittyID format - must be VV-G-LLL-SSSS-T-YM-C-X"
}
```

#### Get ChittyID Metadata
```http
GET /metadata/{chittyId}
```

**Response** (200 OK):
```json
{
  "metadata": {
    "entityType": "INFO",
    "description": "User data record"
  },
  "sessionContext": {
    "sessionId": "session-123",
    "project": "my-project"
  },
  "created": "2025-10-04T06:00:00.000Z",
  "source": "id.chitty.cc"
}
```

**Response** (404 Not Found):
```json
{
  "error": "Metadata not found",
  "chittyId": "01-I-NFO-0001-T-25-C-X"
}
```

---

## Authentication Service

**Base URL**: `https://auth.chitty.cc`

JWT-based authentication with session management and RBAC support.

### Endpoints

#### Health Check
```http
GET /health
```

**Response**:
```json
{
  "service": "auth",
  "status": "healthy",
  "features": ["jwt-tokens", "rbac", "session-management"]
}
```

#### Create Token
```http
POST /api/auth/token
Content-Type: application/json
```

**Request Body**:
```json
{
  "chittyId": "01-P-EO-0001-T-25-C-X",
  "permissions": ["read", "write", "admin"],
  "expiresIn": 3600
}
```

**Response** (200 OK):
```json
{
  "access_token": "eyJzdWIiOiIwMS1QLUVPLTAwMDEtVC0yNS1DLVgiLCJpYXQiOjE2OTk...","
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "read write admin"
}
```

**Error** (400 Bad Request):
```json
{
  "error": "ChittyID required"
}
```

#### Verify Token
```http
POST /api/auth/verify
Authorization: Bearer <token>
```

**Response** (200 OK):
```json
{
  "valid": true,
  "chittyId": "01-P-EO-0001-T-25-C-X",
  "permissions": ["read", "write", "admin"],
  "expires": 1699999999
}
```

**Error** (401 Unauthorized):
```json
{
  "valid": false,
  "error": "Invalid or expired token"
}
```

#### Refresh Token
```http
POST /api/auth/refresh
Authorization: Bearer <old-token>
```

**Response** (200 OK):
```json
{
  "access_token": "new_token_here",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "read write admin"
}
```

#### Revoke Session
```http
DELETE /api/auth/session/{sessionId}
```

**Response** (200 OK):
```json
{
  "revoked": true,
  "sessionId": "session-123"
}
```

---

## Sync Service

**Base URLs**:
- `https://sync.chitty.cc`
- `https://api.chitty.cc` (alias)

Platform Integration Hub for cross-session synchronization, project management, and topic categorization.

### Architecture

The Sync service provides two layers:
1. **Platform-Specific Endpoints**: `/neon`, `/notion`, `/github`, `/drive`, `/cloudflare`, `/local`
2. **Unified Resource APIs**: `/api/project`, `/api/session`, `/api/topic`, `/api/todos`

### Core Endpoints

#### Health Check
```http
GET /health
```

**Response**:
```json
{
  "service": "sync",
  "status": "healthy",
  "version": "2.0.0",
  "architecture": "Platform Integration Hub",
  "platforms": ["neon", "notion", "github", "drive", "cloudflare", "local"],
  "resources": ["project", "session", "topic", "todos", "orchestration"],
  "endpoints": {
    "platforms": {
      "neon": "/neon",
      "notion": "/notion",
      "github": "/github",
      "drive": "/drive",
      "cloudflare": "/cloudflare",
      "local": "/local"
    },
    "resources": {
      "project": "/api/project",
      "session": "/api/session",
      "topic": "/api/topic",
      "todos": "/api/todos",
      "orchestrate": "/api/orchestrate",
      "status": "/api/status"
    }
  }
}
```

#### Overall Status
```http
GET /api/status
```

**Response**:
```json
{
  "service": "sync",
  "version": "2.0.0",
  "timestamp": "2025-10-04T06:00:00.000Z",
  "projects": {
    "total": 5,
    "synced": 4
  },
  "sessions": {
    "total": 3,
    "active": 2
  },
  "topics": {
    "categories": 8,
    "total_conversations": 42
  }
}
```

### Project API

#### List Projects
```http
GET /api/project
```

**Response**:
```json
{
  "projects": [
    {
      "id": "my-project",
      "name": "my-project",
      "lastSync": "2025-10-04T06:00:00.000Z",
      "filesWorked": ["file1.js", "file2.js"],
      "consolidatedTodos": [...]
    }
  ],
  "total": 5,
  "timestamp": "2025-10-04T06:00:00.000Z"
}
```

#### Get Project
```http
GET /api/project/{projectId}
```

**Response** (200 OK):
```json
{
  "id": "my-project",
  "name": "my-project",
  "lastSync": "2025-10-04T06:00:00.000Z",
  "filesWorked": ["file1.js", "file2.js"],
  "consolidatedTodos": [...],
  "fromGitHub": true
}
```

#### Create/Sync Project
```http
POST /api/project
Content-Type: application/json
```

**Request Body**:
```json
{
  "id": "my-project",
  "name": "My Project",
  "metadata": {
    "description": "Project description"
  }
}
```

**Response** (201 Created):
```json
{
  "success": true,
  "created": true,
  "project": {
    "id": "my-project",
    "name": "My Project",
    "lastSync": "2025-10-04T06:00:00.000Z",
    "syncedToGitHub": true
  },
  "servicesRegistered": false
}
```

#### Update Project
```http
PUT /api/project/{projectId}
Content-Type: application/json
```

**Request Body**:
```json
{
  "metadata": {
    "updated": "2025-10-04T06:00:00.000Z"
  }
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "project": {...}
}
```

#### Delete Project
```http
DELETE /api/project/{projectId}
```

**Response** (200 OK):
```json
{
  "success": true,
  "deleted": "my-project",
  "note": "Project removed from sync index (GitHub data preserved)"
}
```

### Session API

#### List Sessions
```http
GET /api/session
```

**Response**:
```json
{
  "sessions": [
    {
      "sessionId": "session-123",
      "projectId": "my-project",
      "aiPlatform": "claude",
      "active": true,
      "lastActivity": "2025-10-04T06:00:00.000Z"
    }
  ],
  "total": 3,
  "active": 2,
  "timestamp": "2025-10-04T06:00:00.000Z"
}
```

#### Get Session
```http
GET /api/session/{sessionId}
```

**Response** (200 OK):
```json
{
  "sessionId": "session-123",
  "projectId": "my-project",
  "aiPlatform": "claude",
  "active": true,
  "created": "2025-10-04T05:00:00.000Z",
  "lastActivity": "2025-10-04T06:00:00.000Z"
}
```

#### Register Session
```http
POST /api/session
Content-Type: application/json
```

**Request Body**:
```json
{
  "id": "session-123",
  "projectId": "my-project",
  "aiPlatform": "claude",
  "machineId": "machine-456",
  "metadata": {
    "user": "user@example.com"
  }
}
```

**Response** (201 Created):
```json
{
  "success": true,
  "session": {
    "id": "session-123",
    "projectId": "my-project",
    "aiPlatform": "claude",
    "created": "2025-10-04T06:00:00.000Z",
    "active": true
  }
}
```

#### Update Session (Heartbeat)
```http
PUT /api/session/{sessionId}
Content-Type: application/json
```

**Request Body**:
```json
{
  "active": true,
  "metadata": {...}
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "sessionId": "session-123",
  "updated": "2025-10-04T06:00:00.000Z",
  "note": "Sessions auto-update via heartbeat mechanism"
}
```

#### End Session
```http
DELETE /api/session/{sessionId}
```

**Response** (200 OK):
```json
{
  "success": true,
  "sessionId": "session-123",
  "ended": "2025-10-04T06:00:00.000Z"
}
```

### Topic API

#### List Topics
```http
GET /api/topic
```

**Response**:
```json
{
  "topics": [
    {
      "category": "development",
      "count": 15,
      "avgConfidence": 0.85,
      "lastUpdated": "2025-10-04T06:00:00.000Z"
    }
  ],
  "total": 8,
  "timestamp": "2025-10-04T06:00:00.000Z"
}
```

#### Get Topic Conversations
```http
GET /api/topic/{category}
```

**Response** (200 OK):
```json
{
  "category": "development",
  "conversations": [
    {
      "id": "conv-123",
      "file": "conversation.json",
      "category": "development",
      "subcategories": ["api", "backend"],
      "confidence": 0.9,
      "categorized": "2025-10-04T06:00:00.000Z",
      "content_preview": "Discussion about API endpoints..."
    }
  ],
  "count": 15
}
```

#### Categorize Conversation
```http
POST /api/topic
Content-Type: application/json
```

**Request Body**:
```json
{
  "id": "conv-123",
  "content": "Full conversation text...",
  "file": "conversation.json",
  "category": "development",
  "subcategories": ["api", "backend"],
  "confidence": 0.9
}
```

**Response** (201 Created):
```json
{
  "success": true,
  "conversation": {
    "id": "conv-123",
    "category": "development",
    "subcategories": ["api", "backend"],
    "confidence": 0.9,
    "categorized": "2025-10-04T06:00:00.000Z"
  }
}
```

### Todos API

#### List Projects with Todos
```http
GET /api/todos
```

**Response**:
```json
{
  "projects": [
    {
      "projectId": "my-project",
      "todoCount": 10,
      "lastSync": "2025-10-04T06:00:00.000Z",
      "sessions": 2,
      "pendingTodos": 3,
      "inProgressTodos": 2,
      "completedTodos": 5
    }
  ],
  "total": 5,
  "timestamp": "2025-10-04T06:00:00.000Z"
}
```

#### Get Unified Todos
```http
GET /api/todos/{projectId}
```

**Response** (200 OK):
```json
{
  "projectId": "my-project",
  "todos": [
    {
      "content": "Fix authentication bug",
      "status": "in_progress",
      "activeForm": "Fixing authentication bug",
      "addedBy": "session-123",
      "addedAt": "2025-10-04T05:00:00.000Z"
    }
  ],
  "lastSync": "2025-10-04T06:00:00.000Z",
  "sessions": ["session-123", "session-456"]
}
```

#### Update Unified Todos
```http
POST /api/todos/{projectId}
Content-Type: application/json
```

**Request Body**:
```json
{
  "todos": [
    {
      "content": "Fix authentication bug",
      "status": "completed",
      "activeForm": "Fixed authentication bug"
    }
  ]
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "projectId": "my-project",
  "todos": [...],
  "lastSync": "2025-10-04T06:00:00.000Z",
  "githubSynced": true
}
```

#### Sync Session Todos
```http
PUT /api/todos/{projectId}/sync
Content-Type: application/json
```

**Request Body**:
```json
{
  "sessionId": "session-123",
  "todos": [...]
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "projectId": "my-project",
  "sessionId": "session-123",
  "todos": [...],
  "totalTodos": 10,
  "added": 2,
  "updated": 3,
  "lastSync": "2025-10-04T06:00:00.000Z"
}
```

---

## AI Gateway

**Base URL**: `https://ai.chitty.cc`

OpenAI-compatible API powered by Cloudflare Workers AI.

### Endpoints

#### Health Check
```http
GET /health
```

**Response**:
```json
{
  "status": "healthy",
  "service": "AI Gateway",
  "models": {
    "primary": "@cf/meta/llama-3.1-8b-instruct",
    "embedding": "@cf/baai/bge-base-en-v1.5"
  },
  "timestamp": "2025-10-04T06:00:00.000Z"
}
```

#### Chat Completions
```http
POST /v1/chat/completions
Content-Type: application/json
```

**Request Body**:
```json
{
  "model": "@cf/meta/llama-3.1-8b-instruct",
  "messages": [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "What is ChittyOS?"}
  ],
  "max_tokens": 256,
  "temperature": 0.7
}
```

**Response** (200 OK):
```json
{
  "id": "chatcmpl-1699999999",
  "object": "chat.completion",
  "created": 1699999999,
  "model": "@cf/meta/llama-3.1-8b-instruct",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "ChittyOS is a comprehensive platform..."
      },
      "finish_reason": "stop"
    }
  ]
}
```

#### Embeddings
```http
POST /v1/embeddings
Content-Type: application/json
```

**Request Body**:
```json
{
  "model": "@cf/baai/bge-base-en-v1.5",
  "input": ["Text to embed", "Another text"]
}
```

**Response** (200 OK):
```json
{
  "object": "list",
  "data": [
    {
      "object": "embedding",
      "embedding": [0.1, 0.2, 0.3, ...],
      "index": 0
    },
    {
      "object": "embedding",
      "embedding": [0.4, 0.5, 0.6, ...],
      "index": 1
    }
  ],
  "model": "@cf/baai/bge-base-en-v1.5",
  "usage": {
    "prompt_tokens": 2,
    "total_tokens": 2
  }
}
```

#### List Models
```http
GET /v1/models
```

**Response** (200 OK):
```json
{
  "object": "list",
  "data": [
    {
      "id": "@cf/meta/llama-3.1-8b-instruct",
      "object": "model",
      "created": 1677610602,
      "owned_by": "cloudflare"
    },
    {
      "id": "@cf/baai/bge-base-en-v1.5",
      "object": "model",
      "created": 1677610602,
      "owned_by": "cloudflare"
    }
  ]
}
```

---

## MCP Portal

**Base URLs**:
- `https://mcp.chitty.cc`
- `https://portal.chitty.cc` (alias)

Model Context Protocol service for AI assistant integration.

### Endpoints

#### Health Check
```http
GET /health
```

**Response**:
```json
{
  "service": "mcp",
  "status": "healthy"
}
```

---

## Error Codes

### Standard HTTP Status Codes

| Code | Meaning | Description |
|------|---------|-------------|
| 200 | OK | Request succeeded |
| 201 | Created | Resource created successfully |
| 400 | Bad Request | Invalid request parameters |
| 401 | Unauthorized | Authentication required or failed |
| 404 | Not Found | Resource not found |
| 405 | Method Not Allowed | HTTP method not supported |
| 500 | Internal Server Error | Server error occurred |
| 501 | Not Implemented | Endpoint not available in current environment |
| 502 | Bad Gateway | Upstream service unavailable |

### Service-Specific Errors

#### ChittyID Service
- **Pipeline Error**: ChittyID service unavailable (502)
- **Validation Error**: Invalid ChittyID format (200, `valid: false`)
- **Metadata Not Found**: No metadata for ChittyID (404)

#### Auth Service
- **Token Required**: Missing ChittyID in token request (400)
- **Invalid Token**: Token verification failed (401)
- **Expired Token**: Token has expired (401)

#### Sync Service
- **Project Not Found**: Project doesn't exist (404)
- **Session Not Found**: Session doesn't exist (404)
- **Method Not Allowed**: Unsupported HTTP method (405)
- **Local Sync Unavailable**: Requires Node.js runtime (501)

---

## Rate Limits

Currently, **no rate limits** are enforced on ChittyOS platform services. However, Cloudflare Workers have the following limits:

- **CPU Time**: 50ms per request (Bundled plan)
- **Memory**: 128MB per request
- **Request Size**: 100MB max
- **Response Size**: No limit

For production use, consider implementing:
- API key-based rate limiting
- Per-session request throttling
- Service-specific quotas

---

## Examples

### Complete Authentication Flow

```bash
# 1. Create auth token
curl -X POST https://auth.chitty.cc/api/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "chittyId": "01-P-EO-0001-T-25-C-X",
    "permissions": ["read", "write"],
    "expiresIn": 3600
  }'

# Response: {"access_token": "eyJ...", "token_type": "Bearer", ...}

# 2. Verify token
curl -X POST https://auth.chitty.cc/api/auth/verify \
  -H "Authorization: Bearer eyJ..."

# 3. Use token for protected resource
curl https://api.chitty.cc/api/project \
  -H "Authorization: Bearer eyJ..."

# 4. Refresh token before expiry
curl -X POST https://auth.chitty.cc/api/auth/refresh \
  -H "Authorization: Bearer eyJ..."
```

### Project Sync Workflow

```bash
# 1. Register session
curl -X POST https://api.chitty.cc/api/session \
  -H "Content-Type: application/json" \
  -d '{
    "id": "session-abc123",
    "projectId": "my-app",
    "aiPlatform": "claude",
    "machineId": "mac-456"
  }'

# 2. Create/sync project
curl -X POST https://api.chitty.cc/api/project \
  -H "Content-Type: application/json" \
  -d '{
    "id": "my-app",
    "name": "My Application"
  }'

# 3. Sync session todos
curl -X PUT https://api.chitty.cc/api/todos/my-app/sync \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "session-abc123",
    "todos": [
      {
        "content": "Fix login bug",
        "status": "in_progress",
        "activeForm": "Fixing login bug"
      }
    ]
  }'

# 4. Get unified todos
curl https://api.chitty.cc/api/todos/my-app

# 5. End session
curl -X DELETE https://api.chitty.cc/api/session/session-abc123
```

### AI Gateway Usage

```bash
# Chat completion
curl -X POST https://ai.chitty.cc/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "@cf/meta/llama-3.1-8b-instruct",
    "messages": [
      {"role": "user", "content": "Explain ChittyOS"}
    ],
    "max_tokens": 256
  }'

# Generate embeddings
curl -X POST https://ai.chitty.cc/v1/embeddings \
  -H "Content-Type: application/json" \
  -d '{
    "model": "@cf/baai/bge-base-en-v1.5",
    "input": "ChittyOS platform documentation"
  }'
```

### ChittyID Generation

```bash
# Generate ChittyID (requires API key)
curl -X POST https://id.chitty.cc/generate \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "metadata": {
      "entityType": "PROP",
      "description": "User property record"
    },
    "sessionContext": {
      "sessionId": "session-123",
      "project": "my-app"
    }
  }'

# Validate ChittyID
curl https://id.chitty.cc/validate/01-P-ROP-0001-T-25-C-X

# Get metadata
curl https://id.chitty.cc/metadata/01-P-ROP-0001-T-25-C-X
```

---

## Support

- **Documentation**: See service-specific `/health` endpoints
- **Status**: https://sync.chitty.cc/api/status
- **Platform Health**: https://gateway.chitty.cc/health
- **Worker Logs**: `wrangler tail chittyos-platform-production --env production`

---

**Last Updated**: 2025-10-04
**Worker Version**: 8814a03c-a4d8-43bb-a3a1-1643c3efaa0d
